events {
    worker_connections 1024;
}

http {
    # Configuraci칩n general
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    types_hash_max_size 2048;

    # Logging
    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log;

    # Dashboard principal
    server {
        listen 80 default_server;
        server_name localhost;

        location / {
            return 200 '
<!DOCTYPE html>
<html>
<head>
    <title>RetailTech DevOps Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; background: #f5f5f5; }
        h1 { color: #333; }
        .services { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 30px; }
        .service { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .service h2 { color: #0066cc; margin-top: 0; }
        a { color: #0066cc; text-decoration: none; }
        a:hover { text-decoration: underline; }
        .status { display: inline-block; width: 10px; height: 10px; border-radius: 50%; background: #4caf50; margin-right: 8px; }
    </style>
</head>
<body>
    <h1>游 RetailTech DevOps Environment</h1>
    <p>Ambiente local de desarrollo y testing CI/CD</p>
    
    <div class="services">
        <div class="service">
            <h2><span class="status"></span>Product Service API</h2>
            <p>Microservicio principal de productos</p>
            <a href="http://localhost:3000/health" target="_blank">Health Check</a> |
            <a href="http://localhost:3000/api/products" target="_blank">API</a>
        </div>
        
        <div class="service">
            <h2><span class="status"></span>Jenkins CI/CD</h2>
            <p>Servidor de integraci칩n y despliegue continuo</p>
            <a href="http://localhost:8080" target="_blank">Abrir Jenkins</a><br>
            <small>Usuario: admin / Contrase침a: admin123</small>
        </div>
        
        <div class="service">
            <h2><span class="status"></span>SonarQube</h2>
            <p>An치lisis de calidad de c칩digo</p>
            <a href="http://localhost:9000" target="_blank">Abrir SonarQube</a><br>
            <small>Usuario: admin / Contrase침a: admin</small>
        </div>
        
        <div class="service">
            <h2><span class="status"></span>Grafana</h2>
            <p>Dashboards y visualizaci칩n de m칠tricas</p>
            <a href="http://localhost:3001" target="_blank">Abrir Grafana</a><br>
            <small>Usuario: admin / Contrase침a: admin</small>
        </div>
        
        <div class="service">
            <h2><span class="status"></span>Prometheus</h2>
            <p>Sistema de monitoreo y alertas</p>
            <a href="http://localhost:9090" target="_blank">Abrir Prometheus</a>
        </div>
        
        <div class="service">
            <h2><span class="status"></span>Docker Registry</h2>
            <p>Registro privado de im치genes Docker</p>
            <a href="http://localhost:5000/v2/_catalog" target="_blank">Ver Cat치logo</a>
        </div>
        
        <div class="service">
            <h2><span class="status"></span>Portainer</h2>
            <p>Gesti칩n visual de contenedores Docker</p>
            <a href="https://localhost:9443" target="_blank">Abrir Portainer</a>
        </div>
    </div>
    
    <hr style="margin: 40px 0;">
    <p><strong>Comandos 칰tiles:</strong></p>
    <pre style="background: #282c34; color: #abb2bf; padding: 20px; border-radius: 8px; overflow-x: auto;">
# Ver logs de todos los servicios
docker-compose logs -f

# Ver logs de un servicio espec칤fico
docker-compose logs -f jenkins

# Reiniciar un servicio
docker-compose restart product-service

# Ejecutar tests
docker-compose exec product-service npm test

# Ver estado de contenedores
docker-compose ps

# Detener todo
docker-compose down
    </pre>
</body>
</html>
            ';
            add_header Content-Type text/html;
        }
    }

    # Jenkins
    server {
        listen 8080;
        server_name localhost;

        location / {
            proxy_pass http://jenkins:8080;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }
}
